<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sosyal Medya Paylaşım Takip Sistemi</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        /* Modal animasyonu */
        .modal-content-animated {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Checkbox için özel stil */
        input[type="checkbox"] {
            transform: scale(1.2);
            accent-color: #2563EB;
        }
        
        /* Paylaşılan satırlar için stil */
        .shared-row {
            background-color: #A7F3D0 !important; /* Çim yeşili tonu */
            color: #065F46 !important;
        }

        /* Paylaşılan KPI kartı için yeni stil */
        .shared-kpi {
            background-color: #D1FAE5; /* Açık çim yeşili tonu */
            color: #065F46;
        }
        
        /* Yaklaşan Paylaşımlar için yeni stil */
        .upcoming-kpi {
            background-color: #BFDBFE; /* Açık gökyüzü mavisi */
            color: #1E40AF;
        }

        /* Filtrelenen satırlar için yeni stil */
        .filtered-kpi {
            background-color: #FEEBC7; /* Açık turuncu tonu */
            color: #C05621;
        }
        
        /* Sosyal medyada paylaşılacak mı? Renkleri */
        .social-media-yes {
            background-color: #A7F3D0 !important; /* Pastel yeşil */
            color: #065F46 !important;
        }
        
        .social-media-maybe {
            background-color: #FDE68A !important; /* Pastel sarı */
            color: #92400E !important;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800 antialiased leading-relaxed">
    <div class="container mx-auto p-6 md:p-10 lg:p-12">
        <div class="bg-white rounded-3xl shadow-xl p-6 md:p-10">
            <h1 class="text-3xl md:text-4xl lg:text-5xl font-extrabold text-center text-gray-700 mb-8">Sosyal Medya Paylaşım Takip Sistemi</h1>
            
            <!-- Kontrol Butonları -->
            <div class="flex flex-wrap justify-center gap-4 mb-8">
                <button onclick="document.getElementById('xlsxInput').click()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 9.586V7z" clip-rule="evenodd" />
                    </svg>
                    .xlsx Yükle
                </button>
                <button onclick="exportToXLSX()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 11.586V4a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    .xlsx İndir
                </button>
                <button onclick="showNewRecordForm()" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    Yeni Kayıt
                </button>
                <button onclick="clearData()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                    Temizle
                </button>
            </div>
            <input type="file" id="xlsxInput" accept=".xlsx" class="hidden" onchange="handleFile(this.files)">
            
            <!-- İstatistik Kartları -->
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6 mb-8">
                <div id="totalStat" onclick="filterByShareStatus('all')" class="bg-indigo-200 hover:bg-indigo-300 text-indigo-800 font-bold p-6 rounded-2xl shadow-md transition-all duration-300 cursor-pointer transform hover:scale-105 flex justify-between items-center">
                    <span class="text-lg">Toplam Kayıt</span>
                    <span id="totalCount" class="text-3xl md:text-4xl">0</span>
                </div>
                <div id="sharedStat" onclick="filterByShareStatus('shared')" class="shared-kpi hover:bg-green-300 font-bold p-6 rounded-2xl shadow-md transition-all duration-300 cursor-pointer transform hover:scale-105 flex justify-between items-center">
                    <span class="text-lg">Paylaşılan</span>
                    <span id="sharedCount" class="text-3xl md:text-4xl">0</span>
                </div>
                <div id="unsharedStat" onclick="filterByShareStatus('unshared')" class="bg-pink-200 hover:bg-pink-300 text-pink-800 font-bold p-6 rounded-2xl shadow-md transition-all duration-300 cursor-pointer transform hover:scale-105 flex justify-between items-center">
                    <span class="text-lg">Paylaşılmayan</span>
                    <span id="unsharedCount" class="text-3xl md:text-4xl">0</span>
                </div>
                <div id="upcomingStat" onclick="filterByUpcoming()" class="upcoming-kpi hover:bg-blue-300 font-bold p-6 rounded-2xl shadow-md transition-all duration-300 cursor-pointer transform hover:scale-105 flex justify-between items-center">
                    <span class="text-lg">Yaklaşan Paylaşımlar</span>
                    <span id="upcomingCount" class="text-3xl md:text-4xl">0</span>
                </div>
                <div id="filteredStat" onclick="filterByCurrent()" class="filtered-kpi hover:bg-orange-300 font-bold p-6 rounded-2xl shadow-md transition-all duration-300 cursor-pointer transform hover:scale-105 flex justify-between items-center">
                    <span class="text-lg">Filtrelenen Satır</span>
                    <span id="filteredCount" class="text-3xl md:text-4xl">0</span>
                </div>
            </div>

            <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">Filtrele</h3>
            <!-- Filtreleme Div'leri -->
            <div class="bg-blue-100 p-6 rounded-xl shadow-inner mb-4">
                <div class="flex flex-wrap items-center justify-center gap-4">
                    <div>
                        <label for="routineFilter" class="block text-sm font-medium text-blue-800">Paylaşım Rutini</label>
                        <select id="routineFilter" onchange="applyFilters()" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <option value="">Tümü</option>
                            <option value="Spontane">Spontane</option>
                            <option value="Aylık">Aylık</option>
                            <option value="Yıllık">Yıllık</option>
                        </select>
                    </div>
                    <div>
                        <label for="socialMediaFilter" class="block text-sm font-medium text-blue-800">Sosyal Medyada Paylaşılacak mı?</label>
                        <select id="socialMediaFilter" onchange="applyFilters()" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <option value="">Tümü</option>
                            <option value="Evet">Evet</option>
                            <option value="Hayır">Hayır</option>
                            <option value="Belki">Belki</option>
                        </select>
                    </div>
                    <div>
                        <label for="institutionFilter" class="block text-sm font-medium text-blue-800">Kurum Filtresi</label>
                        <select id="institutionFilter" onchange="applyFilters()" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <option value="">Tümü</option>
                            <option>AİLE VE SOSYAL POLİTİKALAR BAKANLIĞI</option>
                            <option>ÇALIŞMA VE SOSYAL GÜVENLİK BAKANLIĞI</option>
                            <option>ÇEVRE, ŞEHİRCİLİK VE İKLİM DEĞİŞİKLİĞİ BAKANLIĞI</option>
                            <option>ENERJİ VE TABİİ KAYNAKLARI BAKANLIĞI</option>
                            <option>GENÇLİK VE SPOR BAKANLIĞI</option>
                            <option>İÇİŞLERİ BAKANLIĞI</option>
                            <option>KÜLTÜR VE TURİZM BAKANLIĞI</option>
                            <option>MALİYE BAKANLIĞI</option>
                            <option>MİLLİ EĞİTİM BAKANLIĞI</option>
                            <option>SAĞLIK BAKANLIĞI</option>
                            <option>SANAYİ VE TEKNOLOJİ BAKANLIĞI</option>
                            <option>TARIM VE ORMAN BAKANLIĞI</option>
                            <option>TİCARET BAKANLIĞI</option>
                            <option>TUİK</option>
                            <option>ULAŞTIRMA VE ALTYAPI BAKANLIĞI</option>
                            <option>YÖK</option>
                            <option>DİYANET İŞLERİ BAŞKANLIĞI</option>
                            <option>İSTANBUL PROJE KOORDİNASYON BİRİMİ (İPKB)</option>
                            <option>PROJELER</option>
                        </select>
                    </div>
                    <div>
                        <label for="sectorFilter" class="block text-sm font-medium text-blue-800">Sektör Filtresi</label>
                        <select id="sectorFilter" onchange="applyFilters()" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <option value="">Tümü</option>
                        </select>
                    </div>
                    <div>
                        <label for="startDateFilter" class="block text-sm font-medium text-blue-800">Başlangıç Tarihi</label>
                        <input type="date" id="startDateFilter" onchange="applyFilters()" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                    </div>
                    <div>
                        <label for="endDateFilter" class="block text-sm font-medium text-blue-800">Bitiş Tarihi</label>
                        <input type="date" id="endDateFilter" onchange="applyFilters()" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                    </div>

                </div>
            </div>
            
            <div class="bg-gray-200 p-6 rounded-xl shadow-inner mb-8">
                <div class="flex flex-wrap items-center justify-center gap-6">
                    <div>
                        <label for="similarShareFilter" class="flex items-center space-x-2 text-sm font-medium text-gray-800">
                            <input type="checkbox" id="similarShareFilter" onchange="applyFilters()">
                            <span>Bakanlık Paylaşımı Olanlar</span>
                        </label>
                    </div>
                    <div>
                        <label for="webSourceFilter" class="flex items-center space-x-2 text-sm font-medium text-gray-800">
                            <input type="checkbox" id="webSourceFilter" onchange="applyFilters()">
                            <span>Kaynak Web Adresi Olanlar</span>
                        </label>
                    </div>
                    <div>
                        <label for="almanacFilter" class="flex items-center space-x-2 text-sm font-medium text-gray-800">
                            <input type="checkbox" id="almanacFilter" onchange="applyFilters()">
                            <span>Belirli bir günü ve haftası var mı</span>
                        </label>
                    </div>
                    <div>
                        <label for="tuikFilter" class="flex items-center space-x-2 text-sm font-medium text-gray-800">
                            <input type="checkbox" id="tuikFilter" onchange="applyFilters()">
                            <span>TUİK'te yer alanlar</span>
                        </label>
                    </div>
                    <button onclick="clearFilters()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-bold py-2 px-4 rounded-full transition-colors duration-300">
                        Filtreleri Temizle
                    </button>
                </div>
            </div>
            
            <div class="bg-gray-50 p-6 rounded-xl shadow-inner mb-8">
                <h3 class="text-lg font-semibold text-gray-600 mb-4 text-center">Görünür Sütunlar</h3>
                <div id="columnCheckboxes" class="flex flex-wrap justify-center gap-x-6 gap-y-2 text-sm text-gray-600">
                    <!-- Sütun checkbox'ları burada dinamik olarak oluşturulacak -->
                </div>
            </div>
            
            <!-- Sürükle-Bırak Alanı -->
            <div id="dropZone" class="border-2 border-dashed border-gray-400 rounded-xl p-6 text-center text-gray-500 mb-8 transition-colors duration-300 hover:bg-gray-50">
                Dosyanızı buraya sürükleyip bırakın (.xlsx)
            </div>
            
            <!-- Veri Tablosu -->
            <div class="overflow-x-auto rounded-xl shadow-md">
                <table id="dataTable" class="w-full text-sm text-left text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-200 sticky top-0 border-2 border-gray-400">
                        <tr>
                            <th scope="col" class="py-3 px-6 border-r-2 border-gray-400"><input type="checkbox" id="selectAll" onclick="toggleSelectAll()"></th>
                            <th scope="col" class="py-3 px-6 border-r-2 border-gray-400" data-column="Kurum">Kurum</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="Alt Kurum">Alt Kurum</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="Sektör">Sektör</th>
                            <th scope="col" class="py-3 px-6 border-r-2 border-gray-400" data-column="Paylaşım Konusu">Konu</th>
                            <th scope="col" class="py-3 px-6 border-r-2 border-gray-400" data-column="Paylaşım Tarihi">Paylaşım Tarihi</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="Belirli bir günü ve haftası var mı?">Belirli bir günü ve haftası var mı?</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="İrtibat Kişisinin Ünvanı">İrtibat Kişisinin Ünvanı</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="İrtibat Kişisinin Adı Soyadı">İrtibat Kişisinin Adı Soyadı</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="Paylaştığımız Gönderinin Bağlantı Adresi">Paylaşım Adresi</th>
                            <th scope="col" class="py-3 px-6 border-r-2 border-gray-400" data-column="Açıklama">Açıklama</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="Almanakta yer alan belirli gün ve hafta ismi">Almanak Adı</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="Bakanlığın Paylaşım Metni">Bakanlık Metni</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="TUİK'te var mı?">TUİK'te var mı?</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="TUİK'te yayımlanma takvimi">TUİK Takvimi</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="Paylaşım Rutini">Paylaşım Rutini</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="Sosyal Medyada Paylaşılacak mı?">Sosyal Medyada Paylaşılacak mı?</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="Kaynak">Kaynak</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="Kaynak İnternet Adresi">Kaynak İnternet Adresi</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="Bakanlık Sosyal Medya Paylaşımı Var mı?">Bakanlık Paylaşımı Var mı?</th>
                            <th scope="col" class="py-3 px-6 hidden border-r-2 border-gray-400" data-column="Paylaşıldı">Paylaşıldı ✔</th>
                            <th scope="col" class="py-3 px-6">İşlemler</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody" class="bg-white divide-y-2 divide-gray-300"></tbody>
                </table>
            </div>

            <!-- Modal for New Record -->
            <div id="newRecordModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
                <div class="relative top-20 mx-auto p-8 rounded-xl bg-white shadow-2xl w-11/12 md:max-w-xl lg:max-w-2xl modal-content-animated">
                    <span class="close-btn text-gray-500 hover:text-gray-700 text-3xl font-bold absolute top-4 right-6 cursor-pointer" onclick="closeNewRecordModal()">&times;</span>
                    <h2 class="text-2xl font-bold text-gray-700 mb-6 text-center">Yeni Kayıt Ekle/Düzenle</h2>
                    <form id="recordForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label class="block text-sm font-medium text-gray-700">Kurum</label><select name="Kurum" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50"></select></div>
                            <div><label class="block text-sm font-medium text-gray-700">Alt Kurum</label><input type="text" name="Alt Kurum" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50" placeholder="İl müdürlüğü, bölge müdürlüğü..."></div>
                            <div><label class="block text-sm font-medium text-gray-700">Sektör</label><input type="text" name="Sektör" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50" placeholder="eğitim, sağlık vs...."></div>
                            <div><label class="block text-sm font-medium text-gray-700">Paylaşım Konusu</label><input type="text" name="Paylaşım Konusu" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50"></div>
                            <div><label class="block text-sm font-medium text-gray-700">Paylaşım Tarihi</label><input type="date" name="Paylaşım Tarihi" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50"></div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Belirli bir günü ve haftası var mı?</label>
                                <select name="Belirli bir günü ve haftası var mı?" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50">
                                    <option value="Hayır">Hayır</option>
                                    <option value="Evet">Evet</option>
                                </select>
                            </div>
                            <div><label class="block text-sm font-medium text-gray-700">İrtibat Kişisinin Adı Soyadı</label><input type="text" name="İrtibat Kişisinin Adı Soyadı" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50"></div>
                            <div><label class="block text-sm font-medium text-gray-700">İrtibat Kişisinin Ünvanı</label><input type="text" name="İrtibat Kişisinin Ünvanı" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50"></div>
                            <div><label class="block text-sm font-medium text-gray-700">İrtibat Kişisi İletişim</label><input type="text" name="Sorumlu Kişi İrtibat" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50" placeholder="0 5... veya mail adresi"></div>
                            <div><label class="block text-sm font-medium text-gray-700">Paylaştığımız Gönderinin Bağlantı Adresi</label><input type="text" name="Paylaştığımız Gönderinin Bağlantı Adresi" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50"></div>
                            <div><label class="block text-sm font-medium text-gray-700">Açıklama</label><textarea name="Açıklama" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50"></textarea></div>
                            <div><label class="block text-sm font-medium text-gray-700">Almanakta yer alan belirli gün ve hafta ismi</label><input type="text" name="Almanakta yer alan belirli gün ve hafta ismi" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50" placeholder="örn. Dünya Çocuk günü, Yeşilay Günü.."></div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Bakanlığın Paylaşım Metni</label>
                                <textarea name="Bakanlığın Paylaşım Metni" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">TUİK'te var mı?</label>
                                <select name="TUİK'te var mı?" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50">
                                    <option value="Hayır">Hayır</option>
                                    <option value="Evet">Evet</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">TUİK'te yayımlanma takvimi</label>
                                <input type="text" name="TUİK'te yayımlanma takvimi" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50" placeholder="her ayın ilk haftası, her yılın mart ayı vs."></div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Paylaşım Rutini</label>
                                <select name="Paylaşım Rutini" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50">
                                    <option value="Spontane">Spontane</option>
                                    <option value="Aylık">Aylık</option>
                                    <option value="Yıllık">Yıllık</option>
                                </select>
                            </div>
                            <!-- Yeni Alan Başlangıcı -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Sosyal Medyada Paylaşılacak mı?</label>
                                <select name="Sosyal Medyada Paylaşılacak mı?" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50">
                                    <option value="Hayır">Hayır</option>
                                    <option value="Evet">Evet</option>
                                    <option value="Belki">Belki</option>
                                </select>
                            </div>
                            <!-- Yeni Alan Bitişi -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Kaynak</label>
                                <input type="text" name="Kaynak" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50" placeholder="Brifing, TUİK, web adresi vs.">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Kaynak İnternet Adresi</label>
                                <input type="url" name="Kaynak İnternet Adresi" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Bakanlık Sosyal Medya Paylaşımı Var mı?</label>
                                <select name="Bakanlık Sosyal Medya Paylaşımı Var mı?" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-gray-50">
                                    <option value="Hayır">Hayır</option>
                                    <option value="Evet">Evet</option>
                                </select>
                            </div>
                            <div class="flex items-center space-x-2 mt-2">
                                <label for="modalPaylasildi" class="text-sm font-medium text-gray-700">Paylaşıldı ✔</label>
                                <input type="checkbox" name="Paylaşıldı" id="modalPaylasildi">
                            </div>
                        </div>
                        <div class="flex justify-end mt-6 space-x-4">
                            <button type="button" onclick="closeNewRecordModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-full transition-colors duration-300">İptal</button>
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full transition-colors duration-300">Kaydet</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <p class="text-center text-sm text-gray-500 mt-8 mb-2">
                Veriler bu cihazda, tarayıcı hafızasında saklanır (localStorage).
            </p>
            <p class="text-center text-xs text-gray-400">&copy; Made By Barış Amaç / İl Planlama Uzmanı </p>
        </div>
    </div>
    
    <script>
        let data = JSON.parse(localStorage.getItem('shareData')) || [];
        let filteredData = [...data];
        let editIndex = null;
        let currentShareFilter = 'all';

        // Sürükle-Bırak İşlevselliği
        const dropZone = document.getElementById('dropZone');
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.target.classList.add('bg-blue-50');
        });
        dropZone.addEventListener('dragleave', (e) => {
            e.target.classList.remove('bg-blue-50');
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            e.target.classList.remove('bg-blue-50');
            handleFile(e.dataTransfer.files);
        });

        const allColumns = {
            'Kurum': true,
            'Alt Kurum': false,
            'Sektör': false,
            'Paylaşım Konusu': true,
            'Paylaşım Tarihi': true,
            'Belirli bir günü ve haftası var mı?': false,
            'İrtibat Kişisinin Ünvanı': false,
            'İrtibat Kişisinin Adı Soyadı': false,
            'Paylaştığımız Gönderinin Bağlantı Adresi': false,
            'Açıklama': true,
            'Almanakta yer alan belirli gün ve hafta ismi': false,
            'Bakanlığın Paylaşım Metni': false,
            "TUİK'te var mı?": false,
            "TUİK'te yayımlanma takvimi": false,
            "Paylaşım Rutini": false,
            "Sosyal Medyada Paylaşılacak mı?": false,
            "Kaynak": false,
            "Kaynak İnternet Adresi": false,
            "Bakanlık Sosyal Medya Paylaşımı Var mı?": false,
            'Paylaşıldı': false
        };
        
        const institutions = ["AİLE VE SOSYAL POLİTİKALAR BAKANLIĞI", "ÇALIŞMA VE SOSYAL GÜVENLİK BAKANLIĞI", "ÇEVRE, ŞEHİRCİLİK VE İKLİM DEĞİŞİKLİĞİ BAKANLIĞI", "ENERJİ VE TABİİ KAYNAKLARI BAKANLIĞI", "GENÇLİK VE SPOR BAKANLIĞI", "İÇİŞLERİ BAKANLIĞI", "KÜLTÜR VE TURİZM BAKANLIĞI", "MALİYE BAKANLIĞI", "MİLLİ EĞİTİM BAKANLIĞI", "SAĞLIK BAKANLIĞI", "SANAYİ VE TEKNOLOJİ BAKANLIĞI", "TARIM VE ORMAN BAKANLIĞI", "TİCARET BAKANLIĞI", "TUİK", "ULAŞTIRMA VE ALTYAPI BAKANLIĞI", "YÖK", "DİYANET İŞLERİ BAŞKANLIĞI", "İSTANBUL PROJE KOORDİNASYON BİRİMİ (İPKB)", "PROJELER"];
        
        function handleFile(files) {
            const file = files[0];
            if (file && file.name.endsWith('.xlsx')) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const workbook = XLSX.read(e.target.result, { type: 'binary' });
                    const sheetName = workbook.SheetNames[0];
                    const sheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(sheet);
                    data = jsonData.map(row => {
                        const newRow = { ...row };
                        // Excel'den gelen tarih hücresi varsa JS tarihine dönüştür
                        if (newRow['Paylaşım Tarihi'] && typeof newRow['Paylaşım Tarihi'] === 'number') {
                            newRow['Paylaşım Tarihi'] = new Date(Date.UTC(0, 0, newRow['Paylaşım Tarihi'] - 1)).toISOString().slice(0, 10);
                        }
                        if (newRow['Almanakta yer alan belirli gün ve hafta ismi'] && typeof newRow['Almanakta yer alan belirli gün ve hafta ismi'] === 'number') {
                            newRow['Almanakta yer alan belirli gün ve hafta ismi'] = new Date(Date.UTC(0, 0, newRow['Almanakta yer alan belirli gün ve hafta ismi'] - 1)).toISOString().slice(0, 10);
                        }
                        newRow['Paylaşıldı'] = newRow['Paylaşıldı'] === '✔' || newRow['Paylaşıldı'] === true;
                        // Yeni eklenen sütun için varsayılan değeri ayarlayın
                        if (!newRow['Sosyal Medyada Paylaşılacak mı?']) {
                           newRow['Sosyal Medyada Paylaşılacak mı?'] = 'Hayır';
                        }
                        return newRow;
                    });
                    filteredData = [...data];
                    localStorage.setItem('shareData', JSON.stringify(data));
                    updateSectorFilter();
                    applyFilters();
                };
                reader.readAsBinaryString(file);
            }
        }

        function updateTable() {
            const tableBody = document.getElementById('tableBody');
            const tableHead = document.querySelector('#dataTable thead tr');

            const visibleColumns = Object.keys(allColumns).filter(col => allColumns[col]);
            const hiddenColumns = Object.keys(allColumns).filter(col => !allColumns[col]);
            
            // Başlıkları güncelle
            tableHead.innerHTML = `<th scope="col" class="py-3 px-6 border-r-2 border-gray-400"><input type="checkbox" id="selectAll" onclick="toggleSelectAll()"></th>`;
            visibleColumns.forEach(col => {
                const th = document.createElement('th');
                th.scope = "col";
                th.className = "py-3 px-6 border-r-2 border-gray-400";
                th.setAttribute('data-column', col);
                th.textContent = formatColumnName(col);
                tableHead.appendChild(th);
            });
            hiddenColumns.forEach(col => {
                const th = document.createElement('th');
                th.scope = "col";
                th.className = "py-3 px-6 hidden border-r-2 border-gray-400";
                th.setAttribute('data-column', col);
                th.textContent = formatColumnName(col);
                tableHead.appendChild(th);
            });
             // İşlemler sütununu ekle
            const actionsTh = document.createElement('th');
            actionsTh.scope = "col";
            actionsTh.className = "py-3 px-6";
            actionsTh.textContent = "İşlemler";
            tableHead.appendChild(actionsTh);


            // Satırları güncelle
            tableBody.innerHTML = '';
            filteredData.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.classList.add('bg-white', 'border-b-2', 'border-gray-300', 'hover:bg-gray-50', 'transition-colors', 'duration-200');

                // Satır renklerini belirle
                if (row['Sosyal Medyada Paylaşılacak mı?'] === 'Evet') {
                    tr.classList.add('social-media-yes');
                } else if (row['Sosyal Medyada Paylaşılacak mı?'] === 'Belki') {
                    tr.classList.add('social-media-maybe');
                }
                
                let rowContent = `<td class="py-4 px-6"><input type="checkbox" class="rowCheckbox" data-index="${index}"></td>`;

                Object.keys(allColumns).forEach(col => {
                    const td = document.createElement('td');
                    td.className = "py-4 px-6 border-r-2 border-gray-300";
                    if (!allColumns[col]) {
                        td.classList.add('hidden');
                    }
                    let cellContent = row[col] || '';
                    if (col === 'Paylaşım Tarihi') {
                        if (cellContent) {
                            try {
                                const dateObj = new Date(cellContent);
                                cellContent = dateObj.toLocaleDateString('tr-TR', { year: 'numeric', month: '2-digit', day: '2-digit' });
                            } catch (e) {
                                console.error('Tarih dönüştürme hatası:', e);
                            }
                        }
                    }
                    if (col === 'Paylaştığımız Gönderinin Bağlantı Adresi' || col === 'Kaynak İnternet Adresi') {
                        if (cellContent) {
                            const a = document.createElement('a');
                            a.href = cellContent;
                            a.target = '_blank';
                            a.className = 'text-blue-500 hover:underline';
                            a.textContent = 'Link';
                            td.appendChild(a);
                        }
                    } else {
                        td.textContent = cellContent;
                    }
                    tr.appendChild(td);
                });

                const actionsTd = document.createElement('td');
                actionsTd.className = "py-4 px-6 flex items-center space-x-2";
                actionsTd.innerHTML = `
                    <button onclick="updateSocialMediaStatus(${index}, 'Evet')" class="text-green-600 hover:text-green-800 transition-colors duration-200">Evet</button>
                    <button onclick="updateSocialMediaStatus(${index}, 'Belki')" class="text-yellow-600 hover:text-yellow-800 transition-colors duration-200">Belki</button>
                    <button onclick="updateSocialMediaStatus(${index}, 'Hayır')" class="text-gray-600 hover:text-gray-800 transition-colors duration-200">Hayır</button>
                    <button onclick="editRecord(${index})" class="text-yellow-600 hover:text-yellow-800 transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                    </button>
                    <button onclick="deleteRecord(${index})" class="text-red-600 hover:text-red-800 transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                    </button>
                `;
                actionsTd.classList.add("py-4", "px-6", "flex", "items-center", "space-x-2");
                tr.appendChild(actionsTd);
                
                const firstCell = document.createElement('td');
                firstCell.className = "py-4 px-6 border-r-2 border-gray-300";
                firstCell.innerHTML = `<input type="checkbox" class="rowCheckbox" data-index="${index}">`;
                tr.prepend(firstCell);

                tableBody.appendChild(tr);
            });
            updateStats();
        }

        function formatColumnName(col) {
            if (col === 'Paylaşım Konusu') return 'Konu';
            if (col === 'Paylaştığımız Gönderinin Bağlantı Adresi') return 'Paylaşım Adresi';
            if (col === 'Almanakta yer alan belirli gün ve hafta ismi') return 'Almanak Adı';
            if (col === 'Bakanlığın Paylaşım Metni') return 'Bakanlık Metni';
            if (col === 'TUİK\'te yayımlanma takvimi') return 'TUİK Takvimi';
            if (col === 'Paylaşıldı') return 'Paylaşıldı ✔';
            if (col === 'Kaynak İnternet Adresi') return 'Kaynak Web Adresi';
            if (col === 'Bakanlık Sosyal Medya Paylaşımı Var mı?') return 'Bakanlık Paylaşımı Var mı?';
            return col;
        }

        function updateStats() {
            const total = data.length;
            const shared = data.filter(row => row['Paylaşıldı']).length;
            const unshared = total - shared;
            const upcoming = data.filter(row => isUpcoming(row)).length;
            
            document.getElementById('totalCount').textContent = total;
            document.getElementById('sharedCount').textContent = shared;
            document.getElementById('unsharedCount').textContent = unshared;
            document.getElementById('upcomingCount').textContent = upcoming;
            document.getElementById('filteredCount').textContent = filteredData.length;

            document.querySelectorAll('.stats > div').forEach(el => el.classList.remove('active'));
            // Bu kısım UI/UX için önemli. Tıklanan kartı vurgulamak isterseniz kullanabilirsiniz.
        }
        
        function isUpcoming(row) {
            if (!row['Paylaşım Tarihi']) return false;
            
            const plannedDate = new Date(row['Paylaşım Tarihi']);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const tenDaysLater = new Date();
            tenDaysLater.setDate(today.getDate() + 10);
            tenDaysLater.setHours(23, 59, 59, 999);
            
            return plannedDate >= today && plannedDate <= tenDaysLater && !row['Paylaşıldı'];
        }

        function updateSectorFilter() {
            const sectors = [...new Set(data.map(row => row['Sektör']).filter(s => s))];
            const sectorFilter = document.getElementById('sectorFilter');
            sectorFilter.innerHTML = '<option value="">Tümü</option>';
            sectors.forEach(sector => {
                const option = document.createElement('option');
                option.value = sector;
                option.textContent = sector;
                sectorFilter.appendChild(option);
            });
        }

        function toggleColumn(column) {
            allColumns[column] = !allColumns[column];
            updateColumnCheckboxes();
            updateTable();
        }

        function updateColumnCheckboxes() {
            const container = document.getElementById('columnCheckboxes');
            container.innerHTML = '';
            
            const sortedColumns = Object.keys(allColumns).sort((a, b) => {
                const aChecked = allColumns[a];
                const bChecked = allColumns[b];
                if (aChecked && !bChecked) return -1;
                if (!aChecked && bChecked) return 1;
                return 0;
            });

            sortedColumns.forEach(col => {
                const label = document.createElement('label');
                label.className = 'flex items-center';
                const input = document.createElement('input');
                input.type = 'checkbox';
                input.checked = allColumns[col];
                input.setAttribute('data-column', col);
                input.className = 'mr-1';
                input.onchange = () => toggleColumn(col);
                
                const span = document.createElement('span');
                span.textContent = formatColumnName(col);
                
                label.appendChild(input);
                label.appendChild(span);
                container.appendChild(label);
            });
        }

        
function parseTurkishDate(str) {
    if (!str) return null;
    let s = String(str).trim();

    // Drop time if present, e.g. "01.09.2025 14:30"
    const spaceIdx = s.indexOf(" ");
    if (spaceIdx > -1) s = s.slice(0, spaceIdx);

    // If it's already a Date object serialized (ISO) or yyyy-mm-dd, Date can read it reliably.
    // We still normalize to yyyy-mm-ddT00:00:00 for safe comparisons.
    const isoLike = /^\d{4}-\d{1,2}-\d{1,2}$/;
    if (isoLike.test(s)) {
        const [y,m,d] = s.split("-");
        return new Date(`${y}-${String(m).padStart(2,"0")}-${String(d).padStart(2,"0")}T00:00:00`);
    }

    // dd.mm.yyyy or dd.mm.yy
    if (s.includes(".")) {
        const parts = s.split(".");
        if (parts.length === 3) {
            const [dd, mm, yy] = parts;
            const year = yy.length === 2 ? ("20" + yy) : yy;
            return new Date(`${year}-${String(mm).padStart(2,"0")}-${String(dd).padStart(2,"0")}T00:00:00`);
        }
    }

    // dd/mm/yyyy or yyyy/mm/dd (best effort)
    if (s.includes("/")) {
        const parts = s.split("/");
        if (parts.length === 3) {
            let [a,b,c] = parts;
            if (a.length == 4) { // yyyy/mm/dd
                return new Date(`${a}-${String(b).padStart(2,"0")}-${String(c).padStart(2,"0")}T00:00:00`);
            } else if (c.length == 4) { // dd/mm/yyyy
                return new Date(`${c}-${String(b).padStart(2,"0")}-${String(a).padStart(2,"0")}T00:00:00`);
            }
        }
    }

    // Fallback: let Date try; then normalize
    const d = new Date(s);
    if (!isNaN(d)) {
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth()+1).padStart(2,"0");
        const dd = String(d.getDate()).padStart(2,"0");
        return new Date(`${yyyy}-${mm}-${dd}T00:00:00`);
    }
    return null;
}

function applyFilters() {
            let tempData = [...data];
            
            if (currentShareFilter === 'shared') {
                tempData = tempData.filter(row => row['Paylaşıldı']);
            } else if (currentShareFilter === 'unshared') {
                tempData = tempData.filter(row => !row['Paylaşıldı']);
            } else if (currentShareFilter === 'upcoming') {
                tempData = tempData.filter(isUpcoming);
            }

            const institution = document.getElementById('institutionFilter').value;
            const sector = document.getElementById('sectorFilter').value;
            const similarShare = document.getElementById('similarShareFilter').checked;
            const webSource = document.getElementById('webSourceFilter').checked;
            const almanacLinked = document.getElementById('almanacFilter').checked;
            const tuikLinked = document.getElementById('tuikFilter').checked;
            const routine = document.getElementById('routineFilter').value;
            const socialMedia = document.getElementById('socialMediaFilter').value;
            const startDateVal = document.getElementById('startDateFilter')?.value || '';
            const endDateVal = document.getElementById('endDateFilter')?.value || '';
            const startDate = startDateVal ? new Date(startDateVal) : null;
            const endDate = endDateVal ? new Date(endDateVal + 'T23:59:59') : null;

            filteredData = tempData.filter(row => {
                const matchesInstitution = !institution || row['Kurum'] === institution;
                const matchesSector = !sector || row['Sektör'] === sector;
                const matchesSimilarShare = !similarShare || (row['Bakanlık Sosyal Medya Paylaşımı Var mı?'] && row['Bakanlık Sosyal Medya Paylaşımı Var mı?'].toLowerCase() === 'evet');
                const matchesWebSource = !webSource || (row['Kaynak İnternet Adresi'] && row['Kaynak İnternet Adresi'].trim() !== '');
                const matchesAlmanac = !almanacLinked || (row['Belirli bir günü ve haftası var mı?'] && row['Belirli bir günü ve haftası var mı?'].toLowerCase() === 'evet');
                const matchesTUİK = !tuikLinked || (row['TUİK\'te var mı?'] && row['TUİK\'te var mı?'].toLowerCase() === 'evet');
                const matchesRoutine = !routine || row['Paylaşım Rutini'] === routine;
                const matchesSocialMedia = !socialMedia || row['Sosyal Medyada Paylaşılacak mı?'] === socialMedia;
                
                const matchesDate = (() => { if (!startDate && !endDate) return true; const val = row['Paylaşım Tarihi']; if (!val) return false; const d = parseTurkishDate(val); if (!d || isNaN(d)) return false; if (startDate && d < startDate) return false; if (endDate && d > endDate) return false; return true; })();
                return matchesInstitution && matchesSector && matchesSimilarShare && matchesWebSource && matchesAlmanac && matchesTUİK && matchesRoutine && matchesSocialMedia && matchesDate;
            });

            updateTable();
        }
        
        function filterByCurrent() {
            // Sadece mevcut filtrelenmiş veriyi göster, herhangi bir filtreyi değiştirme.
            updateTable();
        }

        function filterByShareStatus(status) {
            currentShareFilter = status;
            applyFilters();
        }
        
        function filterByUpcoming() {
            currentShareFilter = 'upcoming';
            applyFilters();
        }

        function clearFilters() {
            document.getElementById('institutionFilter').value = '';
            document.getElementById('sectorFilter').value = '';
            document.getElementById('similarShareFilter').checked = false;
            document.getElementById('webSourceFilter').checked = false;
            document.getElementById('almanacFilter').checked = false;
            document.getElementById('tuikFilter').checked = false;
            document.getElementById('routineFilter').value = '';
            document.getElementById('socialMediaFilter').value = '';
            const sDate=document.getElementById('startDateFilter'); if(sDate) sDate.value='';
            const eDate=document.getElementById('endDateFilter'); if(eDate) eDate.value='';
            currentShareFilter = 'all';
            applyFilters();
        }

        function showNewRecordForm() {
            editIndex = null;
            const modal = document.getElementById('newRecordModal');
            modal.classList.remove('hidden');
            document.getElementById('recordForm').reset();
            populateModalSelects();
            document.getElementById('recordForm').onsubmit = saveRecord;
        }

        function populateModalSelects() {
            const kurumSelect = document.querySelector('#newRecordModal select[name="Kurum"]');
            kurumSelect.innerHTML = '<option value="">Seçiniz</option>';
            institutions.forEach(kurum => {
                const option = document.createElement('option');
                option.value = kurum;
                option.textContent = kurum;
                kurumSelect.appendChild(option);
            });
        }
        
        function closeNewRecordModal() {
            document.getElementById('newRecordModal').classList.add('hidden');
            document.getElementById('recordForm').reset();
            editIndex = null;
        }

        function saveRecord(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const newRecord = {};
            formData.forEach((value, key) => {
                newRecord[key] = key === 'Paylaşıldı' ? document.getElementById('modalPaylasildi').checked : value;
            });

            if (editIndex !== null) {
                const originalIndex = data.findIndex(item => JSON.stringify(item) === JSON.stringify(filteredData[editIndex]));
                if (originalIndex !== -1) {
                    data[originalIndex] = newRecord;
                }
            } else {
                data.push(newRecord);
            }

            filteredData = [...data];
            localStorage.setItem('shareData', JSON.stringify(data));
            applyFilters();
            closeNewRecordModal();
        }

        function editRecord(index) {
            editIndex = index;
            const record = filteredData[index];
            const form = document.getElementById('recordForm');
            populateModalSelects();
            
            Object.keys(record).forEach(key => {
                const input = form.querySelector(`[name="${key}"]`);
                if (input) {
                    if (input.type === 'checkbox') {
                        input.checked = record[key];
                    } else {
                        input.value = record[key] || '';
                    }
                }
            });
            
            document.getElementById('newRecordModal').classList.remove('hidden');
            form.onsubmit = saveRecord;
        }

        function deleteRecord(index) {
            if (confirm('Bu kaydı silmek istediğinize emin misiniz?')) {
                const originalIndex = data.findIndex(item => JSON.stringify(item) === JSON.stringify(filteredData[index]));
                if (originalIndex !== -1) {
                    data.splice(originalIndex, 1);
                    filteredData.splice(index, 1);
                    localStorage.setItem('shareData', JSON.stringify(data));
                    applyFilters();
                }
            }
        }
        
        function updateSocialMediaStatus(index, newStatus) {
            const originalRecord = filteredData[index];
            const originalIndex = data.findIndex(item => JSON.stringify(item) === JSON.stringify(originalRecord));
            if (originalIndex !== -1) {
                data[originalIndex]['Sosyal Medyada Paylaşılacak mı?'] = newStatus;
                if (newStatus === 'Evet') {
                    data[originalIndex]['Paylaşıldı'] = true;
                } else {
                    data[originalIndex]['Paylaşıldı'] = false;
                }
                localStorage.setItem('shareData', JSON.stringify(data));
                applyFilters();
            }
        }

        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll').checked;
            document.querySelectorAll('.rowCheckbox').forEach(cb => cb.checked = selectAll);
        }

        function exportToXLSX() {
            const ws = XLSX.utils.json_to_sheet(filteredData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Paylaşım Paneli');
            XLSX.writeFile(wb, 'paylasim_paneli.xlsx');
        }
        
        function clearData() {
            if (confirm('Tüm verileri silmek istediğinize emin misiniz?')) {
                data = [];
                filteredData = [];
                localStorage.removeItem('shareData');
                updateSectorFilter();
                applyFilters();
            }
        }

        // İlk yüklemede ve güncellemelerde çalışacak ana fonksiyonlar
        function initialize() {
            updateSectorFilter();
            updateColumnCheckboxes();
            applyFilters();
        }
        
        initialize();

        window.onclick = function(event) {
            const modal = document.getElementById('newRecordModal');
            if (event.target == modal) {
                closeNewRecordModal();
            }
        }
    </script>
</body>
</html>
